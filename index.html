<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>砖拽 转 砖驻转</title>
    <script src="https://unpkg.com/react@17.0.2/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17.0.2/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .game-container {
            text-align: center;
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        .button {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 3rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 5px;
        }
        .correct { background-color: #d4edda; }
        .incorrect { background-color: #f8d7da; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const colors = ['', '', '专拽', '爪', '住', '转'];
        const animals = ['', '转', '', '住住', '专', '转专'];

        const colorToHex = {
            '': '#FF0000',
            '': '#0000FF',
            '专拽': '#00FF00',
            '爪': '#FFFF00',
            '住': '#800080',
            '转': '#FFA500'
        };

        const animalToEmoji = {
            '': '',
            '转': '',
            '': '',
            '住住': '',
            '专': '',
            '转专': ''
        };

        function FamilyMatchingGame() {
            const [gameMode, setGameMode] = React.useState('colors');
            const [targetItem, setTargetItem] = React.useState('');
            const [score, setScore] = React.useState(0);
            const [showFeedback, setShowFeedback] = React.useState(false);
            const [isCorrect, setIsCorrect] = React.useState(false);
            const [playerName, setPlayerName] = React.useState('');
            const [gameStarted, setGameStarted] = React.useState(false);

            const playAudio = React.useCallback((type) => {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                const now = audioContext.currentTime;

                if (type === 'correct') {
                    for (let i = 0; i < 3; i++) {
                        oscillator.frequency.setValueAtTime(1000, now + i * 0.1);
                        oscillator.frequency.setValueAtTime(500, now + i * 0.1 + 0.05);
                        gainNode.gain.setValueAtTime(0.5, now + i * 0.1);
                        gainNode.gain.setValueAtTime(0, now + i * 0.1 + 0.05);
                    }
                    oscillator.start(now);
                    oscillator.stop(now + 0.3);
                } else if (type === 'incorrect') {
                    oscillator.frequency.setValueAtTime(800, now);
                    oscillator.frequency.exponentialRampToValueAtTime(400, now + 0.5);
                    gainNode.gain.setValueAtTime(0.5, now);
                    gainNode.gain.linearRampToValueAtTime(0, now + 0.5);
                    oscillator.start(now);
                    oscillator.stop(now + 0.5);
                }
            }, []);

            React.useEffect(() => {
                if (gameStarted) {
                    pickNewTargetItem();
                }
            }, [gameMode, gameStarted]);

            const pickNewTargetItem = () => {
                const items = gameMode === 'colors' ? colors : animals;
                const newItem = items[Math.floor(Math.random() * items.length)];
                setTargetItem(newItem);
                setShowFeedback(false);
            };

            const handleItemClick = (clickedItem) => {
                if (clickedItem === targetItem) {
                    setScore(score + 1);
                    setIsCorrect(true);
                    playAudio('correct');
                } else {
                    setIsCorrect(false);
                    playAudio('incorrect');
                }
                setShowFeedback(true);
                setTimeout(() => {
                    pickNewTargetItem();
                }, 2000);
            };

            const toggleGameMode = () => {
                setGameMode(gameMode === 'colors' ? 'animals' : 'colors');
                setScore(0);
            };

            const startGame = () => {
                if (playerName.trim() !== '') {
                    setGameStarted(true);
                }
            };

            const renderItem = (item) => {
                if (gameMode === 'colors') {
                    return (
                        <div 
                            className="button" 
                            style={{ backgroundColor: colorToHex[item] }}
                        ></div>
                    );
                } else {
                    return (
                        <div className="button">
                            {animalToEmoji[item]}
                        </div>
                    );
                }
            };

            if (!gameStarted) {
                return (
                    <div className="game-container">
                        <h1>专  砖拽 砖驻转!</h1>
                        <input
                            type="text"
                            value={playerName}
                            onChange={(e) => setPlayerName(e.target.value)}
                            placeholder="住 转 砖"
                            style={{padding: '0.5rem', marginBottom: '1rem'}}
                        />
                        <br />
                        <button onClick={startGame} style={{padding: '0.5rem 1rem', backgroundColor: 'green', color: 'white', border: 'none', borderRadius: '5px'}}>
                            转 砖拽
                        </button>
                    </div>
                );
            }

            return (
                <div className="game-container">
                    <h1>砖拽 转 砖驻转</h1>
                    <p>砖 {playerName}!  砖拽 </p>
                    <button onClick={toggleGameMode} style={{padding: '0.5rem 1rem', backgroundColor: 'blue', color: 'white', border: 'none', borderRadius: '5px', marginBottom: '1rem'}}>
                        祝 砖拽 {gameMode === 'colors' ? '转' : '爪注'}
                    </button>
                    <p> {gameMode === 'colors' ? '爪注' : ''}  {targetItem}?</p>
                    <div className="grid">
                        {(gameMode === 'colors' ? colors : animals).map((item) => (
                            <button
                                key={item}
                                onClick={() => handleItemClick(item)}
                                style={{backgroundColor: 'transparent', border: 'none', cursor: 'pointer'}}
                            >
                                {renderItem(item)}
                            </button>
                        ))}
                    </div>
                    <p>拽: {score}</p>
                    {showFeedback && (
                        <div className={`feedback ${isCorrect ? 'correct' : 'incorrect'}`}>
                            <h3>{isCorrect ? `  ${playerName}!` : `住 砖, ${playerName}!`}</h3>
                            <p>
                                {isCorrect 
                                    ? `转  转 ${gameMode === 'colors' ? '爪注' : ''} ${targetItem}!` 
                                    : `${gameMode === 'colors' ? '爪注' : ''} / /转 ${targetItem}. 住 砖 住 !`}
                            </p>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<FamilyMatchingGame />, document.getElementById('root'));
    </script>
</body>
</html>
